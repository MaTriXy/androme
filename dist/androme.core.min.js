var androme=function(a){"use strict";function b(a){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b(a)}function c(){for(var a,b=!1,c=0;c<document.styleSheets.length;c++)if(a=document.styleSheets[c],a.cssRules)for(var d=0;d<a.cssRules.length;d++)try{(function(){for(var b,c=a.cssRules[d],e=new Set,f=Array.from(c.style),g=0;g<f.length;g++)b=f[g],e.add(s.convertCamelCase(b));Array.from(document.querySelectorAll(c.selectorText)).forEach(function(a){for(var b,d=Array.from(a.style),f=0;f<d.length;f++)b=d[f],e.add(s.convertCamelCase(b));var g=t.getStyle(a),h={},i=!0,j=!1,k=void 0;try{for(var l,m=e[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value,o=c.style[n];a.style[n]?h[n]=a.style[n]:g[n]===o?h[n]=g[n]:o&&("fontSize"===n?h[n]=g[n]:"width"===n||"height"===n||"lineHeight"===n||"verticalAlign"===n||"columnGap"===n||"top"===n||"right"===n||"bottom"===n||"left"===n||"marginTop"===n||"marginRight"===n||"marginBottom"===n||"marginLeft"===n||"paddingTop"===n||"paddingRight"===n||"paddingBottom"===n||"paddingLeft"===n?h[n]=/^[A-Za-z\-]+$/.test(o)||s.isPercent(o)?o:s.convertPX(o,g.fontSize):null==h[n]&&(h[n]=o))}}catch(a){j=!0,k=a}finally{try{i||null==m.return||m.return()}finally{if(j)throw k}}p.settings.preloadImages&&s.hasValue(h.backgroundImage)&&"initial"!==h.backgroundImage&&h.backgroundImage.split(",").map(function(a){return a.trim()}).forEach(function(a){var b=t.parseBackgroundUrl(a);""===b||v.has(b)||v.set(b,{width:0,height:0,url:b})});var q=t.getElementCache(a,"styleMap");q?Object.assign(q,h):(t.setElementCache(a,"style",g),t.setElementCache(a,"styleMap",h))})})()}catch(c){b||(alert("External CSS files cannot be parsed when loading this program from your hard drive with Chrome 64+ (file://). Either use a local web server (http://), embed your CSS files into a <style> tag, or use a different browser. See the README for further instructions.\n\n"+"".concat(a.href,"\n\n").concat(c)),b=!0)}}function d(a){a&&s.hasValue(a.src)&&v.set(a.src,{width:a.naturalWidth,height:a.naturalHeight,url:a.src})}function e(b){var c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(q!==b){var d=c?b.cached():b.create();if(a.settings=p||0===Object.keys(a.settings).length?d.settings:Object.assign(d.settings,a.settings),p=d.application?d.application:new lib.base.Application(d.framework),p.settings=a.settings,p.builtInExtensions=d.builtInExtensions,p.nodeObject=d.nodeObject,p.registerController(d.viewController),p.registerResource(d.resourceHandler),Array.isArray(a.settings.builtInExtensions)){var e=new Set,f=p.builtInExtensions,g=!0,h=!1,i=void 0;try{for(var j,k,l=a.settings.builtInExtensions[Symbol.iterator]();!(g=(j=l.next()).done);g=!0)if(k=j.value,k=k.toLowerCase().trim(),f[k])e.add(f[k]);else for(var n in f)n.startsWith("".concat(k,"."))&&e.add(f[n])}catch(a){h=!0,i=a}finally{try{g||null==l.return||l.return()}finally{if(h)throw i}}var o=!0,r=!1,s=void 0;try{for(var t,u,v=e[Symbol.iterator]();!(o=(t=v.next()).done);o=!0)u=t.value,p.registerExtension(u)}catch(a){r=!0,s=a}finally{try{o||null==v.return||v.return()}finally{if(r)throw s}}}q=b,a.system=b.system}m()}function f(){function a(){p.loading=!1,p.settings.preloadImages&&j&&Array.from(j.getElementsByClassName("androme.preload")).forEach(function(a){return j.removeChild(a)}),p.resourceHandler.imageDimensions=v;var a=!0,c=!1,d=void 0;try{for(var e,f,g=p.elements[Symbol.iterator]();!(a=(e=g.next()).done);a=!0){f=e.value,""===p.appName?(""===f.id&&(f.id="untitled"),p.appName=f.id):""===f.id&&(f.id="content_".concat(p.size));var h=s.trimNull(f.dataset.filename).replace(new RegExp(".".concat(p.viewController.settingsInternal.layout.fileExtension,"$")),"")||f.id,i=s.convertInt(f.dataset.iteration)+1;f.dataset.iteration=i.toString(),f.dataset.layoutName=s.convertWord(1<i?"".concat(h,"_").concat(i):h),p.initCache(f)&&(p.createDocument(),p.setConstraints(),p.setResources(),u.add(f))}}catch(a){c=!0,d=a}finally{try{a||null==g.return||g.return()}finally{if(c)throw d}}"function"==typeof b&&b.call(p)}if(p&&!p.closed){var b;p.elements.clear(),p.loading=!1,c();for(var e=arguments.length,f=Array(e),g=0;g<e;g++)f[g]=arguments[g];""===p.appName&&0===f.length&&f.push(document.body);for(var h,i=0;i<f.length;i++)h=f[i],"string"==typeof h&&(h=document.getElementById(h)),h instanceof HTMLElement&&p.elements.add(h);var j=p.elements.values().next().value;if(p.settings.preloadImages&&j){var k=!0,l=!1,m=void 0;try{for(var n,o,q=v.values()[Symbol.iterator]();!(k=(n=q.next()).done);k=!0)if(o=n.value,0===o.width&&0===o.height&&o.url){var r=document.createElement("IMG");r.src=o.url,r.complete&&0<r.naturalWidth&&0<r.naturalHeight?(o.width=r.naturalWidth,o.height=r.naturalHeight):(r.className="androme.preload",r.style.display="none",j.appendChild(r))}}catch(a){l=!0,m=a}finally{try{k||null==q.return||q.return()}finally{if(l)throw m}}}var t=Array.from(p.elements).map(function(a){var b=[];return Array.from(a.querySelectorAll("IMG")).forEach(function(a){a.complete?d(a):b.push(a)}),b}).reduce(function(c,a){return c.concat(a)},[]);if(0===t.length)a();else{p.loading=!0;var w=t.map(function(a){return new Promise(function(b,c){a.onload=b,a.onerror=c})});Promise.all(w).then(function(b){Array.isArray(b)&&b.forEach(function(a){try{d(a.srcElement)}catch(a){}}),a()}).catch(function(b){var c=b.srcElement?b.srcElement.src:"";(!s.hasValue(c)||confirm("FAIL: ".concat(c)))&&a()})}return{then:function(a){p.loading?b=a:a()}}}}function g(a){p&&s.isString(a.name)&&Array.isArray(a.tagNames)&&p.registerExtension(a)}function h(a,c){if(p){var d=p.getExtension(a);d&&"object"===b(c)&&Object.assign(d.options,c)}}function i(a){return p&&p.getExtension(a)}function j(a,c){if("object"===b(a))g(a);else if(s.isString(a))if("object"===b(c))h(a,c);else return i(a)}function k(){return p&&!p.loading&&!p.closed}function l(){p&&!p.loading&&0<p.size&&p.finalize()}function m(){if(p){var a=!0,b=!1,c=void 0;try{for(var d,e,f=u[Symbol.iterator]();!(a=(d=f.next()).done);a=!0)e=d.value,delete e.dataset.iteration,delete e.dataset.layoutName}catch(a){b=!0,c=a}finally{try{a||null==f.return||f.return()}finally{if(b)throw c}}u.clear(),p.reset()}}function n(){p&&!p.loading&&0<p.size&&(!p.closed&&p.finalize(),p.resourceHandler.file.saveAllToDisk(p.viewData))}function o(){return p?p.toString():""}var p,q,r=[lib.util,lib.dom],s=r[0],t=r[1];a.settings={},a.system={};var u=new Set,v=new Map;return a.setFramework=e,a.parseDocument=f,a.registerExtension=g,a.configureExtension=h,a.getExtension=i,a.ext=j,a.ready=k,a.close=l,a.reset=m,a.saveAllToDisk=n,a.toString=o,a.lib=lib,a}({});
