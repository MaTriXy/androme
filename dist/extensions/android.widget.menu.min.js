this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.menu=function(){"use strict";var e=android.lib.base.Resource,t=androme.lib.constant,n=androme.lib.dom,a=androme.lib.enumeration,r=androme.lib.util,i=android.lib.constant,o=android.lib.enumeration,l=android.lib.util;const d={MENU:"menu",ITEM:"item",GROUP:"group"},s={id:/^@\+id\/\w+$/,title:/^.+$/,titleCondensed:/^.+$/,icon:/^@drawable\/.+$/,onClick:/^.+$/,showAsAction:/^(ifRoom|never|withText|always|collapseActionView)$/,actionLayout:/^@layout\/.+$/,actionViewClass:/^.+$/,actionProviderClass:/^.+$/,alphabeticShortcut:/^[a-zA-Z]+$/,alphabeticModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,numericShortcut:/^[0-9]+$/,numericModifiers:/(META|CTRL|ALT|SHIFT|SYM|FUNCTION)+/g,checkable:/^(true|false)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^[0-9]+$/},c={id:/^@\+id\/\w+$/,checkableBehavior:/^(none|all|single)$/,visible:/^(true|false)$/,enabled:/^(true|false)$/,menuCategory:/^(container|system|secondary|alternative)$/,orderInCategory:/^[0-9]+$/},u=["showAsAction","actionViewClass","actionProviderClass"];function m(e,t){return e.some(e=>e.element.type===t)}function h(e,t,n){for(const a in t.dataset){const r=t.dataset[a];if(r&&e[a]){const t=r.match(e[a]);t&&(n[u.includes(a)?"app":"android"][a]=Array.from(new Set(t)).join("|"))}}}function E(e){if(""!==e.title)return e.title;for(const t of r.flatMap(Array.from(e.childNodes),e=>n.getElementAsNode(e)))if(t.textElement)return t.textContent.trim();return""}const p=new class extends androme.lib.base.Extension{constructor(e,n,a,r){super(e,n,a,r),this.require(t.EXT_NAME.EXTERNAL,!0)}init(e){if(this.included(e)){let t=!1;if(e.children.length){const n=e.children[0].tagName;t=Array.from(e.children).every(e=>e.tagName===n);let a=e.parentElement;for(;a;){if("NAV"===a.tagName&&this.application.parseElements.has(a)){t=!1;break}a=a.parentElement}}t&&(Array.from(e.querySelectorAll("NAV")).forEach(t=>{"none"===n.getStyle(e).display&&(n.setElementCache(t,"andromeExternalDisplay","none"),t.style.display="block")}),this.application.parseElements.add(e))}return!1}condition(e){return this.included(e.element)}processNode(e){e.documentRoot=!0,e.alignmentType|=4,e.setControlType(d.MENU,o.CONTAINER_NODE.INLINE),e.exclude({procedure:a.NODE_PROCEDURE.ALL,resource:a.NODE_RESOURCE.ALL});const t=this.application.controllerHandler.renderNodeStatic(d.MENU,0,{},"","",e,!0);return e.cascade().forEach(e=>this.subscribersChild.add(e)),{output:t,complete:!0}}processChild(t,u){if(t.plainText)return t.hide(),{output:"",next:!0};const p=l.createAttribute(),N=t.element;let y,g="",b=!1;switch("NAV"===t.tagName?(y=d.MENU,g=E(N),b=!0):t.some(e=>e.length>0)?(t.some(e=>"NAV"===e.tagName)?(y=d.ITEM,t.each(e=>"NAV"!==e.tagName&&e.hide())):(y=d.GROUP,t.every(e=>m(e,"radio"))?p.android.checkableBehavior="single":t.every(e=>m(e,"checkbox"))&&(p.android.checkableBehavior="all")),g=E(N),b=!0):(y=d.ITEM,g=(N.title||N.innerText).trim(),m(t,"checkbox")&&!u.android("checkableBehavior")&&(p.android.checkable="true")),y){case d.MENU:t.alignmentType|=4;break;case d.GROUP:t.alignmentType|=4,h(c,N,p);break;case d.ITEM:if(h(s,N,p),!r.hasValue(p.android.icon)){const a=n.getStyle(N);let r=e.addImageUrl("none"!==a.backgroundImage?a.backgroundImage:a.background,i.PREFIX_ANDROID.MENU);if(""!==r)p.android.icon=`@drawable/${r}`;else{const n=t.find(e=>e.imageElement);n&&""!==(r=e.addImageSrcSet(n.element,i.PREFIX_ANDROID.MENU))&&(p.android.icon=`@drawable/${r}`)}}}if(""!==g){const t=e.addString(g,"",this.application.extensionManager.optionValueAsBoolean(i.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue"));p.android.title=""!==t?`@string/${t}`:g}return t.setControlType(y,o.CONTAINER_NODE.INLINE),t.exclude({procedure:a.NODE_PROCEDURE.ALL,resource:a.NODE_RESOURCE.ALL}),t.render(u),{output:this.application.controllerHandler.renderNodeStatic(y,t.renderDepth,p,"","",t,b),complete:!0,next:y===d.MENU}}postBaseLayout(e){if(this.included(e.element)){Array.from(e.element.querySelectorAll("NAV")).forEach(e=>{const t=n.getElementCache(e,"andromeExternalDisplay");t&&(e.style.display=t,n.deleteElementCache(e,"andromeExternalDisplay"))});const t=this.application.processing;e===t.node&&t.layout&&(t.layout.pathname="res/menu")}}}("android.widget.menu",2,["NAV"]);return androme&&androme.includeAsync(p),p}();
