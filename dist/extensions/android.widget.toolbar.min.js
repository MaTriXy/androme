this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e={FAB:"android.widget.floatingactionbutton",MENU:"android.widget.menu",COORDINATOR:"android.widget.coordinator",TOOLBAR:"android.widget.toolbar",DRAWER:"android.widget.drawer",BOTTOM_NAVIGATION:"android.widget.bottomnavigation"};var t='!0\n<?xml version="1.0" encoding="utf-8"?>\n<resources>\n\t<style name="{@appTheme}" parent="{@parentTheme}">\n!1\n\t\t<item name="{name}">{value}</item>\n!1\n\t</style>\n\t<style name="{@appTheme}.NoActionBar">\n\t\t<item name="windowActionBar">false</item>\n\t\t<item name="windowNoTitle">true</item>\n\t</style>\n\t<style name="AppTheme.AppBarOverlay" parent="{@appBarOverlay}" />\n\t<style name="AppTheme.PopupOverlay" parent="{@popupOverlay}" />\n</resources>\n!0',a=android.lib.base.View,r=androme.lib.enumeration,n=androme.lib.constant,o=android.lib.constant,i=androme.lib.util,d=android.lib.util,l=androme.lib.dom,s=androme.lib.xml,p=android.lib.base.Resource;const c=new class extends androme.lib.base.Extension{constructor(t,a,r,n){super(t,a,r,n),this.require(e.MENU)}init(t){if(this.included(t)&&(Array.from(t.children).some(e=>"NAV"===e.tagName&&!i.includes(e.dataset.ext,n.EXT_NAME.EXTERNAL)&&(e.dataset.ext=(i.hasValue(e.dataset.ext)?`${e.dataset.ext}, `:"")+n.EXT_NAME.EXTERNAL,!0)),t.dataset.target)){const a=document.getElementById(t.dataset.target);a&&t.parentElement!==a&&!i.includes(a.dataset.ext,e.COORDINATOR)&&this.application.elements.add(t)}return!1}processNode(){const t=this.application.viewController,a=this.node,n=this.parent,c=i.hasValue(a.dataset.target),u=Object.assign({},this.options[a.element.id]),m=Object.assign({},u.toolbar),h=Object.assign({},u.appBar),g=Object.assign({},u.collapsingToolbar),O=null!=l.findNestedExtension(a.element,e.MENU),w=a.has("backgroundImage"),f=[],E=[];let T,v=c?0:a.depth,A=a.children.filter(e=>e.auto).length;Array.from(a.element.children).forEach(e=>{if("IMG"===e.tagName){if(i.hasValue(e.dataset.navigationIcon)){const t=p.addImageSrcSet(e,o.DRAWABLE_PREFIX.MENU);""!==t&&(i.overwriteDefault(toolbar,"app","navigationIcon",`@drawable/${t}`),"none"!==l.getStyle(e).display&&A--)}if(i.hasValue(e.dataset.collapseIcon)){const t=p.addImageSrcSet(e,o.DRAWABLE_PREFIX.MENU);""!==t&&(i.overwriteDefault(toolbar,"app","collapseIcon",`@drawable/${t}`),"none"!==l.getStyle(e).display&&A--)}}if(i.hasValue(e.dataset.target))A--;else{const t=l.getNodeFromElement(e);if(t)switch(e.dataset.targetModule){case"appBar":f.push(t),A--;break;case"collapsingToolbar":E.push(t),A--}}});const b=null!=u.collapsingToolbar||E.length>0,D=null!=u.appBar||f.length>0||b;let y="",R="";b?i.overwriteDefault(m,"app","layout_collapseMode","pin"):(D||i.overwriteDefault(m,"android","fitsSystemWindows","true"),i.overwriteDefault(m,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),w?(i.overwriteDefault(f.length>0?h:m,"android","background",`@drawable/${p.addImageURL(a.css("backgroundImage"))}`),a.excludeResource|=r.NODE_RESOURCE.IMAGE_SOURCE):i.overwriteDefault(m,"app","layout_scrollFlags","scroll|enterAlways")),f.length>0?i.overwriteDefault(h,"android","layout_height","?android:attr/actionBarSize"):(i.overwriteDefault(m,"android","layout_height","?android:attr/actionBarSize"),a.excludeProcedure|=r.NODE_PROCEDURE.LAYOUT),O&&D&&(m.app.popupTheme&&(R=m.app.popupTheme.replace("@style/","")),m.app.popupTheme="@style/AppTheme.PopupOverlay");const I=v+(D?1:0)+(b?1:0);if(T=t.renderNodeStatic(o.VIEW_SUPPORT.TOOLBAR,I,m,"match_parent","wrap_content",a,A>0),b&&w){const e=Object.assign({},u.backgroundImage);let n="center";switch(a.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":n="centerCrop";break;case"contain":case"100% 100%":n="fitXY";break;case"auto":n="matrix"}i.overwriteDefault(e,"android","id",`${a.stringId}_image`),i.overwriteDefault(e,"android","src",`@drawable/${p.addImageURL(a.css("backgroundImage"))}`),i.overwriteDefault(e,"android","scaleType",n),i.overwriteDefault(e,"android","fitsSystemWindows","true"),i.overwriteDefault(e,"app","layout_collapseMode","parallax"),T=t.renderNodeStatic(o.NODE_ANDROID.IMAGE,I,e,"match_parent","match_parent")+T,a.excludeResource|=r.NODE_RESOURCE.IMAGE_SOURCE}let N="",_=null,S=null;if(D&&(i.overwriteDefault(h,"android","id",`${a.stringId}_appbar`),i.overwriteDefault(h,"android","layout_height",a.viewHeight>0?d.delimitUnit("appbar","height",i.formatPX(a.viewHeight),this.application.settings):"wrap_content"),i.overwriteDefault(h,"android","fitsSystemWindows","true"),O?(h.android.theme&&(y=h.android.theme),h.android.theme="@style/AppTheme.AppBarOverlay",this.createResourceTheme(y,R)):i.overwriteDefault(h,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(_=this.createPlaceholder(this.application.cache.nextId,a,f)).parent=a.parent,_.nodeId=d.stripId(h.android.id),this.application.cache.append(_),N=t.renderNodeStatic(o.VIEW_SUPPORT.APPBAR,c?-1:v,h,"match_parent","wrap_content",_,!0),b&&(v++,i.overwriteDefault(g,"android","id",`${a.stringId}_collapsingtoolbar`),i.overwriteDefault(g,"android","fitsSystemWindows","true"),w||i.overwriteDefault(g,"app","contentScrim","?attr/colorPrimary"),i.overwriteDefault(g,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),i.overwriteDefault(g,"app","toolbarId",a.stringId),(S=this.createPlaceholder(this.application.cache.nextId,a,E)).parent=_,S))){S.each(e=>e.dataset.target=S.nodeId),this.application.cache.append(S);const e=t.renderNodeStatic(o.VIEW_SUPPORT.COLLAPSING_TOOLBAR,c&&!D?-1:v,g,"match_parent","match_parent",S,!0);N=s.replacePlaceholder(N,_.id,e)}return _?(T=s.replacePlaceholder(N,S?S.id:_.id,T),_.render(c?_:n),S?(S.parent=_,S.render(_),a.parent=S):a.parent=_,a.data(e.TOOLBAR,"outerParent",_.stringId),a.render(a.parent)):S?(S.render(c?S:n),a.parent=S,a.render(S)):a.render(c?a:n),a.nodeType=r.NODE_STANDARD.BLOCK,a.excludeResource|=r.NODE_RESOURCE.FONT_STYLE,{output:T,complete:!1}}processChild(){const e=this.node;return e.imageElement&&(i.hasValue(e.dataset.navigationIcon)||i.hasValue(e.dataset.collapseIcon))?(e.hide(),{output:"",complete:!0,next:!0}):{output:"",complete:!1}}beforeInsert(){const t=this.node,a=i.optional(l.findNestedExtension(t.element,e.MENU),"dataset.layoutName");if(""!==a){const e=Object.assign({},this.options[t.element.id]),r=Object.assign({},e.toolbar);i.overwriteDefault(r,"app","menu",`@menu/${a}`),t.app("menu",r.app.menu)}}createResourceTheme(a,r){const n=Object.assign({},this.options.resource);i.overwriteDefault(n,"","appTheme","AppTheme"),i.overwriteDefault(n,"","parentTheme","Theme.AppCompat.Light.DarkActionBar");const o={0:[{appTheme:n.appTheme,parentTheme:n.parentTheme,appBarOverlay:a||"ThemeOverlay.AppCompat.Dark.ActionBar",popupOverlay:r||"ThemeOverlay.AppCompat.Light",1:[]}]};i.overwriteDefault(n,"output","path","res/values"),i.overwriteDefault(n,"output","file",`${e.TOOLBAR}.xml`),this.application.resourceHandler.addTheme(t,o,n)}createPlaceholder(e,t,n=[]){const o=new a(e);o.init(),o.api=t.api;for(const e of n)e.parent=o;return o.inherit(t,"dimensions"),o.auto=!1,o.excludeResource|=r.NODE_RESOURCE.ALL,o}}(e.TOOLBAR,2);return androme&&androme.registerExtension(c),c}();
