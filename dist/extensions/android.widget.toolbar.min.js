this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e='<?xml version="1.0" encoding="utf-8"?>\n<resources>\n!1\n\t<style name="{&appTheme}" parent="{~parentTheme}">\n!items\n\t\t<item name="{&name}">{&value}</item>\n!items\n\t</style>\n!1\n\t<style name="{&appTheme}.NoActionBar">\n\t\t<item name="windowActionBar">false</item>\n\t\t<item name="windowNoTitle">true</item>\n\t</style>\n\t<style name="{&appTheme}.AppBarOverlay" parent="{~appBarOverlay}" />\n\t<style name="{&appTheme}.PopupOverlay" parent="{~popupOverlay}" />\n</resources>',t=android.lib.base.Resource,a=android.lib.base.View,n=androme.lib.constant,r=androme.lib.dom,l=androme.lib.enumeration,o=androme.lib.util,d=androme.lib.xml,i=android.lib.constant,s=android.lib.enumeration,p=android.lib.util;class u extends androme.lib.base.Extension{constructor(e,t,a,n){super(e,t,a,n),this.require("android.widget.menu")}init(e){if(this.included(e)&&(Array.from(e.children).some(e=>"NAV"===e.tagName&&!o.includes(e.dataset.use,n.EXT_NAME.EXTERNAL)&&(e.dataset.use=(o.hasValue(e.dataset.use)?`${e.dataset.use}, `:"")+n.EXT_NAME.EXTERNAL,!0)),e.dataset.target)){const t=document.getElementById(e.dataset.target);t&&e.parentElement!==t&&!o.includes(t.dataset.use,"android.widget.coordinator")&&this.application.parseElements.add(e)}return!1}processNode(e,a){const n=this.application,c=n.controllerHandler,h=o.hasValue(e.dataset.target),m=Object.assign({},this.options[e.element.id]),N=p.createAttribute(m.self),O=p.createAttribute(m.appBar),g=p.createAttribute(m.collapsingToolbar),f=u.findNestedByName(e.element,"android.widget.menu"),A=e.has("backgroundImage"),y=[],T=[];let b=h?0:a.renderDepth+1,E=e.filter(e=>!e.positioned).length;Array.from(e.element.children).forEach(e=>{if("IMG"===e.tagName){if(o.hasValue(e.dataset.navigationIcon)){const a=t.addImageSrcSet(e,i.PREFIX_ANDROID.MENU);""!==a&&(o.defaultWhenNull(toolbar,"app","navigationIcon",`@drawable/${a}`),"none"!==r.getStyle(e).display&&E--)}if(o.hasValue(e.dataset.collapseIcon)){const a=t.addImageSrcSet(e,i.PREFIX_ANDROID.MENU);""!==a&&(o.defaultWhenNull(toolbar,"app","collapseIcon",`@drawable/${a}`),"none"!==r.getStyle(e).display&&E--)}}if(o.hasValue(e.dataset.target))E--;else{const t=r.getElementAsNode(e);if(t)switch(e.dataset.targetModule){case"appBar":y.push(t),E--;break;case"collapsingToolbar":T.push(t),E--}}});const I=m.hasOwnProperty("collapsingToolbar")||T.length,R=m.hasOwnProperty("appBar")||y.length||I;let _="",S="";I?o.defaultWhenNull(N,"app","layout_collapseMode","pin"):(R||o.defaultWhenNull(N,"android","fitsSystemWindows","true"),o.defaultWhenNull(N,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),A?(o.defaultWhenNull(y.length?O:N,"android","background",`@drawable/${t.addImageUrl(e.css("backgroundImage"))}`),e.exclude({resource:l.NODE_RESOURCE.IMAGE_SOURCE})):o.defaultWhenNull(N,"app","layout_scrollFlags","scroll|enterAlways")),y.length?o.defaultWhenNull(O,"android","layout_height","?android:attr/actionBarSize"):(o.defaultWhenNull(N,"android","layout_height","?android:attr/actionBarSize"),e.exclude({procedure:l.NODE_PROCEDURE.LAYOUT})),f&&R&&(N.app.popupTheme&&(S=N.app.popupTheme.replace("@style/","")),N.app.popupTheme="@style/AppTheme.PopupOverlay");const w=b+(R?1:0)+(I?1:0),D=n.extensionManager.optionValueAsBoolean(i.EXT_ANDROID.RESOURCE_STRINGS,"numberResourceValue");e.setControlType(i.SUPPORT_ANDROID.TOOLBAR,s.CONTAINER_NODE.BLOCK);let P=c.renderNodeStatic(i.SUPPORT_ANDROID.TOOLBAR,w,t.formatOptions(N,D),"match_parent","wrap_content",e,E>0);if(I&&A){const a=p.createAttribute(m.backgroundImage);let n="center";switch(e.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":n="centerCrop";break;case"contain":case"100% 100%":n="fitXY";break;case"auto":n="matrix"}o.defaultWhenNull(a,"android","id",`${e.documentId}_image`),o.defaultWhenNull(a,"android","src",`@drawable/${t.addImageUrl(e.css("backgroundImage"))}`),o.defaultWhenNull(a,"android","scaleType",n),o.defaultWhenNull(a,"android","fitsSystemWindows","true"),o.defaultWhenNull(a,"app","layout_collapseMode","parallax"),P=c.renderNodeStatic(i.CONTAINER_ANDROID.IMAGE,w,t.formatOptions(a,D),"match_parent","match_parent")+P,e.exclude({resource:l.NODE_RESOURCE.IMAGE_SOURCE})}let W,B,C="";if(R&&(o.defaultWhenNull(O,"android","id",`${e.documentId}_appbar`),o.defaultWhenNull(O,"android","layout_height",e.hasHeight?o.formatPX(e.height):"wrap_content"),o.defaultWhenNull(O,"android","fitsSystemWindows","true"),f?(O.android.theme&&(_=O.android.theme),O.android.theme="@style/AppTheme.AppBarOverlay",e.data("android.widget.toolbar","themeData",{target:h,appBarOverlay:_,popupOverlay:S})):o.defaultWhenNull(O,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(W=this.createPlaceholder(n.nextId,e,y)).parent=e.parent,W.controlId=p.stripId(O.android.id),W.setControlType(i.SUPPORT_ANDROID.APPBAR,s.CONTAINER_NODE.BLOCK),n.processing.cache.append(W,y.length>0),C=c.renderNodeStatic(i.SUPPORT_ANDROID.APPBAR,h?-1:b,t.formatOptions(O,D),"match_parent","wrap_content",W,!0),I&&(b++,o.defaultWhenNull(g,"android","id",`${e.documentId}_collapsingtoolbar`),o.defaultWhenNull(g,"android","fitsSystemWindows","true"),A||o.defaultWhenNull(g,"app","contentScrim","?attr/colorPrimary"),o.defaultWhenNull(g,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),o.defaultWhenNull(g,"app","toolbarId",e.documentId),(B=this.createPlaceholder(n.nextId,e,T)).parent=W,B))){B.each(e=>e.dataset.target=B.controlId),B.setControlType(i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,s.CONTAINER_NODE.BLOCK),n.processing.cache.append(B,T.length>0);const e=c.renderNodeStatic(i.SUPPORT_ANDROID.COLLAPSING_TOOLBAR,h&&!R?-1:b,t.formatOptions(g,D),"match_parent","match_parent",B,!0);C=d.replacePlaceholder(C,W.id,e)}return W?(P=d.replacePlaceholder(C,B?B.id:W.id,P),W.render(h?W:a),B?(B.parent=W,B.render(W),e.parent=B):e.parent=W,e.data("android.widget.toolbar","outerParent",W.documentId),e.render(e.parent)):B?(B.render(h?B:a),e.parent=B,e.render(B)):e.render(h?e:a),e.containerType=s.CONTAINER_NODE.BLOCK,e.exclude({resource:l.NODE_RESOURCE.FONT_STYLE}),{output:P}}processChild(e){let t=!1;return e.imageElement&&(o.hasValue(e.dataset.navigationIcon)||o.hasValue(e.dataset.collapseIcon))&&(e.hide(),t=!0),{output:"",next:t}}postProcedure(e){const t=o.optionalAsString(u.findNestedByName(e.element,"android.widget.menu"),"dataset.layoutName");if(""!==t){const a=Object.assign({},this.options[e.element.id]),n=p.createAttribute(a.self);o.defaultWhenNull(n,"app","menu",`@menu/${t}`),e.app("menu",n.app.menu)}const a=e.data("android.widget.toolbar","themeData");a&&this.setStyleTheme(a)}setStyleTheme(t){if(this.application.resourceHandler.fileHandler){const a=Object.assign({},this.options.resource);o.defaultWhenNull(a,"appTheme",function(e){for(const t of e){const e=/<style\s+name="([\w$]+)"\s+parent="Theme\.[\w$.]+"/.exec(t.content);if(e)return e[1]}return""}(this.application.resourceHandler.fileHandler.assets)||"AppTheme"),o.defaultWhenNull(a,"parentTheme","Theme.AppCompat.Light.DarkActionBar");const n={appTheme:a.appTheme,appBarOverlay:t.appBarOverlay||"ThemeOverlay.AppCompat.Dark.ActionBar",popupOverlay:t.popupOverlay||"ThemeOverlay.AppCompat.Light",1:[{appTheme:a.appTheme,parentTheme:a.parentTheme,items:[]}]};t.target?n[1]=!1:n.items=n[1][0].items,o.defaultWhenNull(a,"output","path","res/values"),o.defaultWhenNull(a,"output","file","android.widget.toolbar.xml"),this.application.resourceHandler.addStyleTheme(e,n,a)}}createPlaceholder(e,t,n){const o=new a(e,r.createElement(t.actualParent?t.actualParent.baseElement:null,t.block),this.application.controllerHandler.afterInsertNode);o.inherit(t,"base"),o.exclude({resource:l.NODE_RESOURCE.ALL}),o.positioned=!0;let d=Number.MAX_VALUE;return n.forEach(e=>{d=Math.min(d,e.siblingIndex),e.parent=o}),o.siblingIndex=d,o}}const c=new u("android.widget.toolbar",2);return androme&&androme.includeAsync(c),c}();
