this.android=this.android||{},this.android.widget=this.android.widget||{},this.android.widget.toolbar=function(){"use strict";var e={FAB:"android.widget.floatingactionbutton",MENU:"android.widget.menu",COORDINATOR:"android.widget.coordinator",TOOLBAR:"android.widget.toolbar",DRAWER:"android.widget.drawer",BOTTOM_NAVIGATION:"android.widget.bottomnavigation"};var t='!0\n<?xml version="1.0" encoding="utf-8"?>\n<resources>\n\t<style name="{@appTheme}" parent="{@parentTheme}">\n!1\n\t\t<item name="{name}">{value}</item>\n!1\n\t</style>\n\t<style name="{@appTheme}.NoActionBar">\n\t\t<item name="windowActionBar">false</item>\n\t\t<item name="windowNoTitle">true</item>\n\t</style>\n\t<style name="AppTheme.AppBarOverlay" parent="{@appBarOverlay}" />\n\t<style name="AppTheme.PopupOverlay" parent="{@popupOverlay}" />\n</resources>\n!0',a=android.lib.base.View,r=androme.lib.enumeration,n=androme.lib.constant,o=android.lib.constant,i=androme.lib.util,d=android.lib.util,l=androme.lib.dom,s=androme.lib.xml,p=android.lib.base.Resource;const c=new class extends androme.lib.base.Extension{constructor(t,a,r,n){super(t,a,r,n),this.require(e.MENU)}init(t){if(this.included(t)&&(Array.from(t.children).some(e=>"NAV"===e.tagName&&!i.includes(e.dataset.ext,n.EXT_NAME.EXTERNAL)&&(e.dataset.ext=(i.hasValue(e.dataset.ext)?`${e.dataset.ext}, `:"")+n.EXT_NAME.EXTERNAL,!0)),t.dataset.target)){const a=document.getElementById(t.dataset.target);a&&t.parentElement!==a&&!i.includes(a.dataset.ext,e.COORDINATOR)&&this.application.elements.add(t)}return!1}processNode(){function t(e,t,n){const o=new a(e);o.init(),o.api=t.api;for(const e of n)e.parent=o;return o.inherit(t,"dimensions"),o.auto=!1,o.excludeResource|=r.NODE_RESOURCE.ALL,o}const n=this.application.viewController,c=this.node,u=this.parent,m=i.hasValue(c.dataset.target),h=Object.assign({},this.options[c.element.id]),g=Object.assign({},h.toolbar),O=Object.assign({},h.appBar),w=Object.assign({},h.collapsingToolbar),f=null!=l.findNestedExtension(c.element,e.MENU),E=c.has("backgroundImage"),T=[],v=[];let A,b=m?0:c.depth,D=c.children.filter(e=>e.auto).length;Array.from(c.element.children).forEach(e=>{if("IMG"===e.tagName){if(i.hasValue(e.dataset.navigationIcon)){const t=p.addImageSrcSet(e,o.DRAWABLE_PREFIX.MENU);""!==t&&(i.overwriteDefault(toolbar,"app","navigationIcon",`@drawable/${t}`),"none"!==l.getStyle(e).display&&D--)}if(i.hasValue(e.dataset.collapseIcon)){const t=p.addImageSrcSet(e,o.DRAWABLE_PREFIX.MENU);""!==t&&(i.overwriteDefault(toolbar,"app","collapseIcon",`@drawable/${t}`),"none"!==l.getStyle(e).display&&D--)}}if(i.hasValue(e.dataset.target))D--;else{const t=l.getNodeFromElement(e);if(t)switch(e.dataset.targetModule){case"appBar":T.push(t),D--;break;case"collapsingToolbar":v.push(t),D--}}});const y=null!=h.collapsingToolbar||v.length>0,R=null!=h.appBar||T.length>0||y;let I="",N="";y?i.overwriteDefault(g,"app","layout_collapseMode","pin"):(R||i.overwriteDefault(g,"android","fitsSystemWindows","true"),i.overwriteDefault(g,"app","popupTheme","@style/ThemeOverlay.AppCompat.Light"),E?(i.overwriteDefault(T.length>0?O:g,"android","background",`@drawable/${p.addImageURL(c.css("backgroundImage"))}`),c.excludeResource|=r.NODE_RESOURCE.IMAGE_SOURCE):i.overwriteDefault(g,"app","layout_scrollFlags","scroll|enterAlways")),T.length>0?i.overwriteDefault(O,"android","layout_height","?android:attr/actionBarSize"):(i.overwriteDefault(g,"android","layout_height","?android:attr/actionBarSize"),c.excludeProcedure|=r.NODE_PROCEDURE.LAYOUT),f&&R&&(g.app.popupTheme&&(N=g.app.popupTheme.replace("@style/","")),g.app.popupTheme="@style/AppTheme.PopupOverlay");const _=b+(R?1:0)+(y?1:0);if(A=n.renderNodeStatic(o.VIEW_SUPPORT.TOOLBAR,_,g,"match_parent","wrap_content",c,D>0),y&&E){const e=Object.assign({},h.backgroundImage);let t="center";switch(c.css("backgroundSize")){case"cover":case"100% auto":case"auto 100%":t="centerCrop";break;case"contain":case"100% 100%":t="fitXY";break;case"auto":t="matrix"}i.overwriteDefault(e,"android","id",`${c.stringId}_image`),i.overwriteDefault(e,"android","src",`@drawable/${p.addImageURL(c.css("backgroundImage"))}`),i.overwriteDefault(e,"android","scaleType",t),i.overwriteDefault(e,"android","fitsSystemWindows","true"),i.overwriteDefault(e,"app","layout_collapseMode","parallax"),A=n.renderNodeStatic(o.NODE_ANDROID.IMAGE,_,e,"match_parent","match_parent")+A,c.excludeResource|=r.NODE_RESOURCE.IMAGE_SOURCE}let S="",B=null,x=null;if(R&&(i.overwriteDefault(O,"android","id",`${c.stringId}_appbar`),i.overwriteDefault(O,"android","layout_height",c.viewHeight>0?d.delimitUnit("appbar","height",i.formatPX(c.viewHeight),this.application.settings):"wrap_content"),i.overwriteDefault(O,"android","fitsSystemWindows","true"),f?(O.android.theme&&(I=O.android.theme),O.android.theme="@style/AppTheme.AppBarOverlay",this.createResourceTheme(I,N)):i.overwriteDefault(O,"android","theme","@style/ThemeOverlay.AppCompat.Dark.ActionBar"),(B=t(this.application.cache.nextId,c,T)).parent=c.parent,B.nodeId=d.stripId(O.android.id),this.application.cache.append(B),S=n.renderNodeStatic(o.VIEW_SUPPORT.APPBAR,m?-1:b,O,"match_parent","wrap_content",B,!0),y&&(b++,i.overwriteDefault(w,"android","id",`${c.stringId}_collapsingtoolbar`),i.overwriteDefault(w,"android","fitsSystemWindows","true"),E||i.overwriteDefault(w,"app","contentScrim","?attr/colorPrimary"),i.overwriteDefault(w,"app","layout_scrollFlags","scroll|exitUntilCollapsed"),i.overwriteDefault(w,"app","toolbarId",c.stringId),(x=t(this.application.cache.nextId,c,v)).parent=B,x))){x.each(e=>e.dataset.target=x.nodeId),this.application.cache.append(x);const e=n.renderNodeStatic(o.VIEW_SUPPORT.COLLAPSING_TOOLBAR,m&&!R?-1:b,w,"match_parent","match_parent",x,!0);S=s.replacePlaceholder(S,B.id,e)}return B?(A=s.replacePlaceholder(S,x?x.id:B.id,A),B.render(m?B:u),x?(x.parent=B,x.render(B),c.parent=x):c.parent=B,c.data(e.TOOLBAR,"outerParent",B.stringId),c.render(c.parent)):x?(x.render(m?x:u),c.parent=x,c.render(x)):c.render(m?c:u),c.nodeType=r.NODE_STANDARD.BLOCK,c.excludeResource|=r.NODE_RESOURCE.FONT_STYLE,{output:A,complete:!1}}processChild(){const e=this.node;return e.imageElement&&(i.hasValue(e.dataset.navigationIcon)||i.hasValue(e.dataset.collapseIcon))?(e.hide(),{output:"",complete:!0,next:!0}):{output:"",complete:!1}}beforeInsert(){const t=this.node,a=i.optional(l.findNestedExtension(t.element,e.MENU),"dataset.layoutName");if(""!==a){const e=Object.assign({},this.options[t.element.id]),r=Object.assign({},e.toolbar);i.overwriteDefault(r,"app","menu",`@menu/${a}`),t.app("menu",r.app.menu)}}createResourceTheme(a,r){const n=Object.assign({},this.options.resource);i.overwriteDefault(n,"","appTheme","AppTheme"),i.overwriteDefault(n,"","parentTheme","Theme.AppCompat.Light.DarkActionBar");const o={0:[{appTheme:n.appTheme,parentTheme:n.parentTheme,appBarOverlay:a||"ThemeOverlay.AppCompat.Dark.ActionBar",popupOverlay:r||"ThemeOverlay.AppCompat.Light",1:[]}]};i.overwriteDefault(n,"output","path","res/values"),i.overwriteDefault(n,"output","file",`${e.TOOLBAR}.xml`),this.application.resourceHandler.addTheme(t,o,n)}}(e.TOOLBAR,2);return androme&&androme.registerExtension(c),c}();
